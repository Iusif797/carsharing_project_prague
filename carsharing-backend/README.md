# üöó Prague Carsharing Backend API

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ –Ω–∞ Node.js —Å PostgreSQL –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Prague Carsharing.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—à–∏–Ω
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–µ–∑–¥–æ–∫
- –û—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º

### üë®‚Äçüíº –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:

- **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–ø–∞—Ä–∫–æ–º**
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**
- **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã**

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
üì¶ PostgreSQL Database
 ‚îú‚îÄ‚îÄ users          - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
 ‚îú‚îÄ‚îÄ vehicles       - –ê–≤—Ç–æ–º–æ–±–∏–ª–∏
 ‚îú‚îÄ‚îÄ bookings       - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
 ‚îú‚îÄ‚îÄ trips          - –ò—Å—Ç–æ—Ä–∏—è –ø–æ–µ–∑–¥–æ–∫
 ‚îî‚îÄ‚îÄ reviews        - –û—Ç–∑—ã–≤—ã
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –° Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd carsharing-backend

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ API
docker-compose up -d

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec api npx prisma migrate deploy

# –ù–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
docker-compose exec api npm run db:seed
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–æ

```bash
cd carsharing-backend

# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 2. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É:
createdb carsharing

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run db:migrate

# 5. –ù–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î
npm run db:seed

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm run dev
```

## üì° API Endpoints

### Authentication

```
POST /api/auth/register  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST /api/auth/login     - –í—Ö–æ–¥
```

### Users

```
GET    /api/users/me     - –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
PATCH  /api/users/me     - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
```

### Vehicles

```
GET    /api/vehicles              - –í—Å–µ –º–∞—à–∏–Ω—ã
GET    /api/vehicles/:id          - –î–µ—Ç–∞–ª–∏ –º–∞—à–∏–Ω—ã
PATCH  /api/vehicles/:id/location - –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
PATCH  /api/vehicles/:id/status   - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```

### Bookings

```
POST   /api/bookings               - –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω—å
GET    /api/bookings/my            - –ú–æ–∏ –±—Ä–æ–Ω–∏
GET    /api/bookings/:id           - –î–µ—Ç–∞–ª–∏ –±—Ä–æ–Ω–∏
PATCH  /api/bookings/:id/complete  - –ó–∞–≤–µ—Ä—à–∏—Ç—å –±—Ä–æ–Ω—å
DELETE /api/bookings/:id           - –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å
```

### Reviews

```
POST   /api/reviews                   - –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
GET    /api/reviews/vehicle/:id       - –û—Ç–∑—ã–≤—ã –º–∞—à–∏–Ω—ã
```

### Admin Panel üë®‚Äçüíº

```
GET    /api/admin/dashboard           - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET    /api/admin/users               - –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
GET    /api/admin/users/:id           - –î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PATCH  /api/admin/users/:id/status    - –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
GET    /api/admin/vehicles            - –í—Å–µ –º–∞—à–∏–Ω—ã
POST   /api/admin/vehicles            - –î–æ–±–∞–≤–∏—Ç—å –º–∞—à–∏–Ω—É
PATCH  /api/admin/vehicles/:id        - –û–±–Ω–æ–≤–∏—Ç—å –º–∞—à–∏–Ω—É
DELETE /api/admin/vehicles/:id        - –£–¥–∞–ª–∏—Ç—å –º–∞—à–∏–Ω—É
GET    /api/admin/bookings            - –í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
GET    /api/admin/analytics           - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω:

```javascript
headers: {
  'Authorization': 'Bearer YOUR_JWT_TOKEN'
}
```

## üë®‚Äçüíº –ê–¥–º–∏–Ω –¥–æ—Å—Ç—É–ø

**–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**

```
Email: admin@praguecarsharing.com
Password: admin123
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞!

## üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### Prisma Studio (–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

```bash
npm run db:studio
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ `http://localhost:5555`

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é

```bash
psql -h localhost -U postgres -d carsharing
```

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f api

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
docker-compose restart api

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
npm run db:migrate

# –°–±—Ä–æ—Å–∏—Ç—å –ë–î (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
npx prisma migrate reset
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```bash
curl -X GET http://localhost:3000/api/admin/users \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
curl -X GET http://localhost:3000/api/admin/users/USER_ID \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
curl -X PATCH http://localhost:3000/api/admin/users/USER_ID/status \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"isActive": false}'
```

## üåê Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:

   - `JWT_SECRET` - –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é —Å–ª–æ–∂–Ω—É—é —Å—Ç—Ä–æ–∫—É
   - `ADMIN_PASSWORD` - –Ω–∞ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω –∏ SSL**:

   ```bash
   # –ü—Ä–∏–º–µ—Ä —Å nginx + certbot
   sudo apt install nginx certbot python3-certbot-nginx
   sudo certbot --nginx -d api.your–¥omain.com
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ production —Ä–µ–∂–∏–º–µ**:
   ```bash
   NODE_ENV=production docker-compose up -d
   ```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å:

- ‚úÖ –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**API –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞:** `http://localhost:3000`

**–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ endpoints `/api/admin/*`
